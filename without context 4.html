<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Density Explorer</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            // --- CONFIGURATION ---
            const [blur, setBlur] = useState(60);
            const [grainOpacity, setGrainOpacity] = useState(0.08);
            const [speed, setSpeed] = useState(0.4);
            const [coreIntensity, setCoreIntensity] = useState(70); // 0 to 100
            const [showControls, setShowControls] = useState(false);
            const [paletteIndex, setPaletteIndex] = useState(0);

            const palettes = [
                { name: "Saturated Aura", colors: ['#ff0055', '#0077ff', '#ffaa00', '#7700ff'] },
                { name: "Soft Morning", colors: ['#bde0fe', '#ffafcc', '#ffc8dd', '#cdb4db'] },
                { name: "Oceanic", colors: ['#00f5d4', '#00bbf9', '#9b5de5', '#f15bb5'] },
                { name: "Sunset Heat", colors: ['#fb5607', '#ff006e', '#8338ec', '#3a86ff'] }
            ];

            // --- BLOB LOGIC ---
            const Blob = ({ color, speedFactor }) => {
                // Start at random positions within the "safe zone"
                const [pos, setPos] = useState({
                    x: Math.random() * 40 + 30,
                    y: Math.random() * 40 + 30
                });

                // Internal state for smooth movement
                const velocity = useRef({
                    x: (Math.random() - 0.5) * 0.15 * speedFactor,
                    y: (Math.random() - 0.5) * 0.15 * speedFactor
                });

                useEffect(() => {
                    let animationFrame;

                    const update = () => {
                        setPos(prev => {
                            let nextX = prev.x + velocity.current.x * speed;
                            let nextY = prev.y + velocity.current.y * speed;

                            // Border containment: Keep centers within 20-80% of screen
                            // This ensures the "mist" doesn't just disappear off-screen
                            if (nextX < 15 || nextX > 85) velocity.current.x *= -1;
                            if (nextY < 15 || nextY > 85) velocity.current.y *= -1;

                            return { x: nextX, y: nextY };
                        });
                        animationFrame = requestAnimationFrame(update);
                    };

                    update();
                    return () => cancelAnimationFrame(animationFrame);
                }, [speed, speedFactor]);

                return (
                    <div
                        className="absolute rounded-full transition-all duration-700"
                        style={{
                            width: '70vmax',
                            height: '70vmax',
                            // Use radial gradient to create the "Density" look from the reference images
                            background: `radial-gradient(circle, ${color} ${coreIntensity * 0.4}%, transparent 70%)`,
                            left: `${pos.x}%`,
                            top: `${pos.y}%`,
                            transform: 'translate(-50%, -50%)',
                            mixBlendMode: 'multiply',
                            opacity: 0.7,
                            filter: `blur(${blur}px)`,
                        }}
                    />
                );
            };

            return (
                <div className="relative w-full h-screen bg-white overflow-hidden touch-none select-none">

                    {/* The background layer is slightly off-white to help the "multiply" mode pop */}
                    <div className="absolute inset-0 bg-[#fafafa]" />

                    {/* Aura Layer */}
                    <div className="absolute inset-0 z-0">
                        {palettes[paletteIndex].colors.map((c, i) => (
                            <Blob
                                key={`${paletteIndex}-${i}`}
                                color={c}
                                speedFactor={0.8 + (i * 0.1)}
                            />
                        ))}
                    </div>

                    {/* High-fidelity Grain (Matches the textured references) */}
                    <div
                        className="absolute inset-0 z-10 pointer-events-none"
                        style={{
                            opacity: grainOpacity,
                            backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 250 250' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='5' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")`
                        }}
                    />

                    {/* Control Panel */}
                    <div className={`absolute top-4 left-4 z-50 p-6 rounded-3xl bg-white/90 backdrop-blur-xl shadow-2xl border border-white/50 transition-all duration-500 ${showControls ? 'translate-x-0 opacity-100' : '-translate-x-[calc(100%+40px)] opacity-0'}`}>
                        <h2 className="text-xs font-black mb-6 text-gray-900 uppercase tracking-[0.2em]">Density Explorer</h2>

                        <div className="space-y-6 w-56 text-[11px] font-medium text-gray-600">
                            <div>
                                <div className="flex justify-between mb-2">
                                    <label>Core Density</label>
                                    <span>{coreIntensity}%</span>
                                </div>
                                <input
                                    type="range" min="0" max="100" value={coreIntensity}
                                    onChange={(e) => setCoreIntensity(Number(e.target.value))}
                                    className="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-black"
                                />
                            </div>

                            <div>
                                <div className="flex justify-between mb-2">
                                    <label>Softness (Blur)</label>
                                    <span>{blur}px</span>
                                </div>
                                <input
                                    type="range" min="10" max="150" value={blur}
                                    onChange={(e) => setBlur(Number(e.target.value))}
                                    className="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-black"
                                />
                            </div>

                            <div>
                                <div className="flex justify-between mb-2">
                                    <label>Grain Texture</label>
                                    <span>{Math.round(grainOpacity * 100)}%</span>
                                </div>
                                <input
                                    type="range" min="0" max="0.25" step="0.01" value={grainOpacity}
                                    onChange={(e) => setGrainOpacity(Number(e.target.value))}
                                    className="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-black"
                                />
                            </div>

                            <div>
                                <div className="flex justify-between mb-2">
                                    <label>Shift Speed</label>
                                    <span>{speed.toFixed(1)}</span>
                                </div>
                                <input
                                    type="range" min="0" max="2.5" step="0.1" value={speed}
                                    onChange={(e) => setSpeed(Number(e.target.value))}
                                    className="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-black"
                                />
                            </div>

                            <div className="pt-2">
                                <label className="block mb-2">Mood Palette</label>
                                <select
                                    className="w-full p-2.5 rounded-xl border-none bg-gray-100 text-black outline-none"
                                    value={paletteIndex}
                                    onChange={(e) => setPaletteIndex(Number(e.target.value))}
                                >
                                    {palettes.map((p, i) => (
                                        <option key={i} value={i}>{p.name}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                    </div>

                    {/* Floating UI */}
                    <button
                        onClick={() => setShowControls(!showControls)}
                        className="absolute top-6 right-6 z-50 p-3 rounded-full bg-white/40 backdrop-blur-md border border-white/40 shadow-sm active:scale-95 transition-all"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="text-gray-800">
                            <line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line><line x1="1" y1="14" x2="7" y2="14"></line><line x1="9" y1="8" x2="15" y2="8"></line><line x1="17" y1="16" x2="23" y2="16"></line>
                        </svg>
                    </button>

                    <div className="absolute bottom-8 w-full text-center z-20 pointer-events-none opacity-20">
                        <p className="text-[9px] uppercase tracking-[0.4em] font-medium">Refining Shifting Densities</p>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>